/**
 * 玉子市场 - 样式表
 * Tamako Market Stylesheet
 * @author yuzi83
 * @version 2.1.2
 */

/* ===== 主窗口 ===== */
.tamako-window {
    --theme-primary: #FFB6C1;
    --theme-secondary: #DDA0DD;
    
    position: fixed;
    top: 100px;
    left: 100px;
    width: 380px;
    height: 450px;
    background: linear-gradient(135deg, #FFF5F7 0%, #FFFFFF 50%, #F8F0FF 100%);
    border: 2px solid var(--theme-primary);
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(255, 182, 193, 0.4);
    z-index: 9990;
    display: none;
    flex-direction: column;
    overflow: hidden;
    min-width: 280px;
    min-height: 150px;
    font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
    touch-action: none;
    -webkit-user-select: none;
    user-select: none;
}

.tamako-window.visible { display: flex; }
.tamako-window.dragging { opacity: 0.9; box-shadow: 0 12px 48px rgba(255, 182, 193, 0.6); }
.tamako-window.resizing { opacity: 0.95; }

/* 主题背景 */
.tamako-window.theme-ocean { background: linear-gradient(135deg, #F0F8FF 0%, #FFFFFF 50%, #E6F3FF 100%); }
.tamako-window.theme-sunflower { background: linear-gradient(135deg, #FFFEF0 0%, #FFFFFF 50%, #FFF8E7 100%); }
.tamako-window.theme-night { background: linear-gradient(135deg, #2D2D3A 0%, #1E1E28 50%, #252532 100%); color: #E0E0E0; }

/* 夜间模式 */
.theme-night .tamako-content { background: #1E1E28; color: #E0E0E0; }
.theme-night .tamako-plot-content { background: #2D2D3A; border-color: #3D3D4A; }
.theme-night .tamako-tabs { background: #252532; }
.theme-night .tamako-tab { color: #888; }
.theme-night .tamako-tab.active { background: #1E1E28; }
.theme-night .tamako-history-item { background: #2D2D3A; border-color: #3D3D4A; }
.theme-night .tamako-history-item:hover { background: #3D3D4A; }
.theme-night .tamako-item-preview { color: #CCC; }
.theme-night .tamako-search { background: #252532; border-color: #3D3D4A; }
.theme-night .tamako-search input { color: #E0E0E0; }
.theme-night .tamako-theme-panel { background: #252532; border-color: #3D3D4A; }
.theme-night .tamako-theme-panel select { background: #1E1E28; color: #E0E0E0; border-color: #3D3D4A; }
.theme-night .tamako-delete-bar { background: #2D2D3A; }
.theme-night .tamako-select-all { color: #CCC; }
.theme-night .tamako-delete-cancel { background: #2D2D3A; border-color: #3D3D4A; color: #CCC; }
.theme-night .tamako-empty { color: #888; }

/* 调整大小手柄 */
.tamako-resize { position: absolute; z-index: 10; }
.tamako-resize-e { right: 0; top: 10%; width: 12px; height: 80%; cursor: ew-resize; }
.tamako-resize-s { bottom: 0; left: 10%; width: 80%; height: 12px; cursor: ns-resize; }
.tamako-resize-se { right: 0; bottom: 0; width: 24px; height: 24px; cursor: nwse-resize; }
.tamako-resize-se::after {
    content: ''; position: absolute; right: 4px; bottom: 4px;
    width: 10px; height: 10px; border-right: 3px solid var(--theme-primary); border-bottom: 3px solid var(--theme-primary); opacity: 0.7;
}
.tamako-resize:hover { background: rgba(255, 182, 193, 0.2); }
.tamako-resize:active { background: rgba(255, 182, 193, 0.4); }

/* 头部 */
.tamako-header {
    display: flex; justify-content: space-between; align-items: center;
    padding: 12px 16px;
    background: linear-gradient(135deg, var(--theme-primary) 0%, var(--theme-secondary) 100%);
    border-bottom: 2px solid rgba(255, 255, 255, 0.5);
    cursor: move; user-select: none; flex-shrink: 0; touch-action: none;
}

.tamako-drag-handle { flex: 1; cursor: move; touch-action: none; }

.tamako-title {
    display: flex; align-items: center; gap: 8px;
    font-weight: 700; font-size: 15px; color: #FFFFFF;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2); pointer-events: none;
}

.tamako-controls { display: flex; gap: 4px; flex-shrink: 0; }

.tamako-btn {
    background: rgba(255, 255, 255, 0.3); border: none; color: #FFFFFF;
    cursor: pointer; font-size: 13px; padding: 5px 7px; border-radius: 8px; transition: all 0.2s;
    touch-action: manipulation; -webkit-tap-highlight-color: transparent;
}
.tamako-btn:hover { background: rgba(255, 255, 255, 0.5); }
.tamako-btn:active { background: rgba(255, 255, 255, 0.6); transform: scale(0.95); }
.tamako-btn.close:hover { background: #FF6B6B; }
.tamako-btn.delete-mode.active { background: #FF6B6B; }
.tamako-btn.scan:hover { background: rgba(135, 206, 235, 0.6); }
.tamako-btn.theme-toggle:hover { background: rgba(255, 215, 0, 0.6); }
.tamako-btn:disabled { opacity: 0.6; cursor: not-allowed; }

/* 主题选择面板 */
.tamako-theme-panel { padding: 8px 12px; background: #FFF5F7; border-bottom: 2px solid var(--theme-primary); }
.theme-night .tamako-theme-panel { background: #252532; }
.tamako-theme-panel select {
    width: 100%; padding: 8px 10px; border: 2px solid var(--theme-primary);
    border-radius: 8px; background: #FFFFFF; color: #333; font-size: 13px; cursor: pointer; outline: none;
}

/* 选项卡 */
.tamako-tabs { display: flex; border-bottom: 2px solid var(--theme-primary); background: #FFF5F7; flex-shrink: 0; }
.tamako-tab {
    flex: 1; padding: 10px; background: none; border: none; color: #888;
    cursor: pointer; font-size: 13px; font-weight: 600;
    border-bottom: 3px solid transparent; transition: all 0.2s; margin-bottom: -2px;
    touch-action: manipulation; -webkit-tap-highlight-color: transparent;
}
.tamako-tab:hover { color: var(--theme-primary); background: rgba(255, 255, 255, 0.5); }
.tamako-tab:active { background: rgba(255, 255, 255, 0.7); }
.tamako-tab.active { color: var(--theme-primary); border-bottom-color: var(--theme-primary); background: #FFFFFF; }
.theme-night .tamako-tab.active { background: #1E1E28; }
#tamako-history-count { font-weight: 700; }

/* 德拉提示 */
.tamako-toast {
    position: absolute; top: 50px; left: 50%; transform: translateX(-50%) translateY(-10px);
    background: linear-gradient(135deg, var(--theme-primary) 0%, var(--theme-secondary) 100%);
    color: #FFF; padding: 8px 16px; border-radius: 20px;
    font-size: 13px; font-weight: 600; box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    opacity: 0; pointer-events: none; transition: all 0.3s ease; z-index: 100; white-space: nowrap;
}
.tamako-toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* 内容区 */
.tamako-content {
    flex: 1; overflow-y: auto; padding: 14px;
    font-size: 14px; color: #333333; line-height: 1.7; background: #FFFFFF;
    -webkit-overflow-scrolling: touch; overscroll-behavior: contain;
}
.tamako-content::-webkit-scrollbar { width: 8px; }
.tamako-content::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); border-radius: 4px; }
.tamako-content::-webkit-scrollbar-thumb { background: linear-gradient(180deg, var(--theme-primary), var(--theme-secondary)); border-radius: 4px; }

.tamako-plot-content {
    padding: 10px; background: linear-gradient(135deg, #FFF8FA 0%, #FFFFFF 100%);
    border-radius: 12px; border: 1px solid rgba(0, 0, 0, 0.1);
    user-select: text; -webkit-user-select: text;
}

/* 搜索高亮 */
.tamako-plot-content mark, .tamako-item-preview mark {
    background: var(--theme-primary); color: #FFF; padding: 1px 3px; border-radius: 3px;
}

/* 空状态 */
.tamako-empty {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    height: 100%; min-height: 100px; color: #999; text-align: center; padding: 20px;
}
.tamako-empty .icon { font-size: 36px; margin-bottom: 10px; }

/* 搜索栏 */
.tamako-search {
    display: flex; align-items: center; gap: 8px;
    padding: 10px 12px; background: #FFF8FA; border: 2px solid var(--theme-primary);
    border-radius: 10px; margin-bottom: 12px;
}
.theme-night .tamako-search { background: #252532; }
.tamako-search i { color: #999; font-size: 12px; }
.tamako-search input { flex: 1; border: none; background: transparent; outline: none; font-size: 13px; color: #333; min-width: 0; }
.tamako-search input::placeholder { color: #AAA; }
.tamako-search-clear {
    background: none; border: none; color: #999; cursor: pointer;
    padding: 4px 8px; border-radius: 4px; transition: all 0.2s; touch-action: manipulation;
}
.tamako-search-clear:hover { background: rgba(0, 0, 0, 0.1); color: #666; }

/* 历史记录 */
.tamako-history-list { display: block; width: 100%; }
.tamako-history-item {
    display: block; position: relative;
    background: linear-gradient(135deg, #FFFFFF 0%, #FFF8FA 100%);
    border: 2px solid rgba(0, 0, 0, 0.1); border-radius: 12px;
    padding: 10px 12px; margin-bottom: 10px; cursor: pointer; transition: all 0.2s;
    touch-action: manipulation; -webkit-tap-highlight-color: transparent;
}
.tamako-history-item:last-child { margin-bottom: 0; }
.tamako-history-item:hover { border-color: var(--theme-primary); transform: translateX(3px); }
.tamako-history-item:active { transform: scale(0.98); }
.tamako-history-item.delete-mode { cursor: default; padding-left: 36px; }
.tamako-history-item.delete-mode:hover { transform: none; }
.tamako-history-item .tamako-checkbox {
    position: absolute; left: 10px; top: 50%; transform: translateY(-50%);
    width: 20px; height: 20px; cursor: pointer; accent-color: var(--theme-primary);
}
.tamako-item-time { font-size: 12px; color: var(--theme-primary); margin-bottom: 4px; font-weight: 600; }
.tamako-item-preview { font-size: 13px; color: #555; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

/* 删除操作栏 */
.tamako-delete-bar {
    display: flex; justify-content: space-between; align-items: center;
    padding: 10px 14px; background: linear-gradient(135deg, #FFF0F3 0%, #FFE4E9 100%);
    border-top: 2px solid var(--theme-primary); flex-shrink: 0;
}
.tamako-select-all {
    display: flex; align-items: center; gap: 6px; cursor: pointer;
    font-size: 13px; color: #666; font-weight: 500; touch-action: manipulation;
}
.tamako-select-all input { accent-color: var(--theme-primary); width: 18px; height: 18px; }
.tamako-delete-actions { display: flex; gap: 8px; }
.tamako-delete-confirm {
    padding: 8px 16px; background: linear-gradient(135deg, #FF6B6B 0%, #FF8E8E 100%);
    border: none; border-radius: 8px; color: #fff; cursor: pointer;
    font-size: 12px; font-weight: 600; transition: all 0.2s; touch-action: manipulation;
}
.tamako-delete-confirm:hover { transform: scale(1.05); }
.tamako-delete-confirm:active { transform: scale(0.95); }
.tamako-delete-cancel {
    padding: 8px 16px; background: #FFFFFF; border: 2px solid #DDD;
    border-radius: 8px; color: #666; cursor: pointer;
    font-size: 12px; font-weight: 600; transition: all 0.2s; touch-action: manipulation;
}
.tamako-delete-cancel:hover { border-color: var(--theme-primary); }

/* 最小化 */
.tamako-window.minimized .tamako-content,
.tamako-window.minimized .tamako-tabs,
.tamako-window.minimized .tamako-delete-bar,
.tamako-window.minimized .tamako-theme-panel,
.tamako-window.minimized .tamako-resize { display: none !important; }
.tamako-window.minimized { height: auto !important; min-height: auto; }

/* ===== 工具栏按钮（可拖拽）===== */
.tamako-toggle {
    --theme-primary: #FFB6C1; --theme-secondary: #DDA0DD;
    position: fixed; z-index: 10000;
    background: linear-gradient(135deg, var(--theme-primary) 0%, var(--theme-secondary) 100%);
    border: 2px solid #FFFFFF; border-radius: 12px; padding: 8px 14px;
    cursor: grab; color: #FFFFFF; display: flex; align-items: center; gap: 6px;
    font-size: 14px; font-weight: 600; transition: transform 0.2s, box-shadow 0.2s;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15); text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
    touch-action: none; -webkit-tap-highlight-color: transparent; -webkit-user-select: none; user-select: none;
}
.tamako-toggle:hover { transform: scale(1.05); box-shadow: 0 6px 16px rgba(0,0,0,0.2); }
.tamako-toggle:active, .tamako-toggle.dragging { cursor: grabbing; transform: scale(1.02); box-shadow: 0 8px 24px rgba(0,0,0,0.25); }
.tamako-toggle.active { filter: brightness(1.1); }
.tamako-toggle.has-new { animation: tamako-bounce 0.5s ease infinite alternate; }
.tamako-toggle-icon { font-size: 16px; pointer-events: none; }
.tamako-toggle-text { pointer-events: none; }
@keyframes tamako-bounce { from { transform: translateY(0); } to { transform: translateY(-3px); } }

/* ===== 移动端适配 ===== */
.tamako-window.tamako-mobile { min-width: 260px; min-height: 200px; max-width: calc(100vw - 20px); max-height: calc(100vh - 60px); }
.tamako-mobile .tamako-header { padding: 10px 12px; }
.tamako-mobile .tamako-title { font-size: 14px; }
.tamako-mobile .tamako-btn { padding: 8px 10px; font-size: 14px; min-width: 36px; min-height: 36px; display: flex; align-items: center; justify-content: center; }
.tamako-mobile .tamako-controls { gap: 6px; }
.tamako-mobile .tamako-tab { padding: 12px 8px; font-size: 12px; }
.tamako-mobile .tamako-content { padding: 12px; }
.tamako-mobile .tamako-search { padding: 12px; }
.tamako-mobile .tamako-search input { font-size: 16px; }
.tamako-mobile .tamako-history-item { padding: 12px; }
.tamako-mobile .tamako-history-item.delete-mode { padding-left: 40px; }
.tamako-mobile .tamako-checkbox { width: 22px; height: 22px; }
.tamako-mobile .tamako-resize-e { width: 20px; }
.tamako-mobile .tamako-resize-s { height: 20px; }
.tamako-mobile .tamako-resize-se { width: 32px; height: 32px; }
.tamako-mobile .tamako-resize-se::after { width: 14px; height: 14px; right: 6px; bottom: 6px; border-width: 3px; }
.tamako-mobile .tamako-delete-bar { padding: 12px; flex-wrap: wrap; gap: 10px; }
.tamako-mobile .tamako-delete-confirm, .tamako-mobile .tamako-delete-cancel { padding: 10px 18px; font-size: 13px; }
.tamako-toggle-mobile { padding: 10px 16px; font-size: 13px; border-radius: 24px; box-shadow: 0 4px 16px rgba(0,0,0,0.2); }
.tamako-mobile .tamako-theme-panel select { padding: 12px; font-size: 14px; }

/* ===== 设置面板 ===== */
#tamako-market-settings .inline-drawer { border: 1px solid #3f3f46; border-radius: 8px; margin: 5px 0; overflow: hidden; }
#tamako-market-settings .inline-drawer-header { display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; background: #252528; cursor: pointer; }
#tamako-market-settings .inline-drawer-header:hover { background: #2d2d30; }
#tamako-market-settings .inline-drawer-content { background: #1a1a1d; border-top: 1px solid #3f3f46; }
#tamako-market-settings .checkbox_label { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; cursor: pointer; color: #e4e4e7; }
#tamako-market-settings .checkbox_label input { accent-color: #FF69B4; }
#tamako-market-settings .menu_button { padding: 6px 12px; background: #3f3f46; border: 1px solid #52525b; border-radius: 4px; color: #e4e4e7; cursor: pointer; font-size: 13px; transition: all 0.2s; }
#tamako-market-settings .menu_button:hover { background: #52525b; }
#tamako-market-settings .menu_button.tamako-reset { background: #ef4444; border-color: #dc2626; }
#tamako-market-settings .menu_button.tamako-reset:hover { background: #dc2626; }

.tamako-settings-tags { margin: 10px 0; }
.tamako-settings-tags label { display: block; margin-bottom: 5px; font-size: 13px; color: #a1a1aa; }
.tamako-settings-tags input { width: 100%; padding: 6px 8px; background: #27272a; border: 1px solid #3f3f46; border-radius: 4px; color: #e4e4e7; box-sizing: border-box; font-size: 13px; }
.tamako-settings-tags input:focus { outline: none; border-color: #FF69B4; }
.tamako-settings-tags .hint { font-size: 11px; color: #71717a; margin-top: 4px; }

.tamako-settings-numbers { margin: 12px 0; padding: 10px; background: #27272a; border-radius: 6px; }
.tamako-number-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
.tamako-number-row:last-child { margin-bottom: 0; }
.tamako-number-row label { flex: 1; font-size: 13px; color: #a1a1aa; }
.tamako-number-row input[type="number"] { width: 70px; padding: 4px 8px; background: #1a1a1d; border: 1px solid #3f3f46; border-radius: 4px; color: #e4e4e7; font-size: 13px; text-align: center; }
.tamako-number-row input[type="number"]:focus { outline: none; border-color: #FF69B4; }
.tamako-number-row .hint { font-size: 12px; color: #71717a; min-width: 20px; }

.tamako-settings-buttons { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
.tamako-settings-buttons .menu_button { flex: 1; min-width: 70px; text-align: center; }
.tamako-settings-info { margin-top: 8px; font-size: 12px; color: #71717a; }

/* 装饰 */
.tamako-window::before {
    content: ''; position: absolute; top: -1px; left: 20px; right: 20px; height: 3px;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent); border-radius: 0 0 3px 3px;
}

/* 响应式媒体查询 */
@media screen and (max-width: 768px) {
    .tamako-window { min-width: 260px; min-height: 200px; }
    .tamako-header { padding: 10px 12px; }
    .tamako-btn { padding: 8px 10px; min-width: 36px; min-height: 36px; }
    .tamako-resize-e { width: 16px; }
    .tamako-resize-s { height: 16px; }
    .tamako-resize-se { width: 28px; height: 28px; }
}

@media screen and (max-width: 480px) {
    .tamako-window { width: calc(100vw - 20px) !important; left: 10px !important; max-height: calc(100vh - 80px); }
    .tamako-toggle { padding: 8px 12px; font-size: 12px; }
    .tamako-toggle-text { display: none; }
}
